<div class="container mt-4">
    <div class="row">
        <div class="col-md-10 offset-md-1">
            <h1 class="mb-3">Choose Your Odoo Edition</h1>
            <p class="lead mb-4">Select the Odoo hosting option that best fits your needs. You can plan and create a local Community instance, or get guidance on Odoo's cloud solutions.</p>

            <div class="accordion" id="odoo-options-accordion">
                <!-- Option 1: Odoo Community (Self-Hosted) -->
                <div class="accordion-item">
                    <h2 class="accordion-header" id="headingCommunity">
                        <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseCommunity" aria-expanded="true" aria-controls="collapseCommunity">
                            <strong>Odoo Community Edition (Self-Hosted)</strong>
                        </button>
                    </h2>
                    <div id="collapseCommunity" class="accordion-collapse collapse show" aria-labelledby="headingCommunity" data-bs-parent="#odoo-options-accordion">
                        <div class="accordion-body">
                            <p>Create a local Odoo environment on your machine without Docker. This is ideal for development, testing, or running a free, self-managed ERP. Describe your business needs, and the agent will plan and create it for you.</p>
                            
                            <!-- Step 1: Planning -->
                            <div class="card shadow-sm mb-4 border-0">
                                <div class="card-header bg-transparent pt-3">
                                    <h5>Step 1: Plan Your Environment</h5>
                                </div>
                                <div class="card-body">
                                    <div class="mb-3">
                                        <label for="business-need" class="form-label">Describe your business need:</label>
                                        <textarea class="form-control" id="business-need" rows="3" placeholder="e.g., 'I need a simple CRM to track leads and a website to sell products.'"></textarea>
                                    </div>
                                    <button data-plan-type="community" class="btn btn-primary plan-btn">
                                        <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true" style="display: none;"></span>
                                        Plan Modules
                                    </button>
                                    <div id="plan-error" class="alert alert-danger mt-3" style="display: none;"></div>
                                </div>
                            </div>

                            <!-- Step 2: Review and Execute -->
                            <div id="plan-display" class="card shadow-sm mb-4 border-0" style="display: none;">
                                <div class="card-header bg-transparent">
                                    <h5>Step 2: Review and Execute Plan</h5>
                                </div>
                                <div class="card-body">
                                    <p id="plan-summary"></p>
                                    <div id="module-container" style="display: none;">
                                        <h6>Modules to be installed:</h6>
                                        <ul id="module-list" class="list-group mb-3"></ul>
                                    </div>
                                    <!-- This new section will appear if the 'website' module is planned -->
                                    <div id="website-design-selector" class="mb-3" style="display: none;" data-theme-group="website-design">
                                        <h6>Select a Website Theme (required)</h6>
                                        <p class="text-muted small">If you include the 'website' module, you must pick which theme to inject. This project requires two themes to be present; they will be added to the modules list.</p>
                                        <input type="hidden" id="website-design-input" value="">
                                        <div class="row g-3 mt-2">
                                            <div class="col-md-6 col-lg-4">
                                                <label for="website-design-select" class="form-label">Theme</label>
                                                <select class="form-select theme-select" id="website-design-select" data-target-input="website-design-input">
                                                    <option value="" selected disabled>Choose a theme...</option>
                                                    <option value="default">Default Odoo Design</option>
                                                    <option value="deployable_brand_theme">Custom Brand Theme</option>
                                                    <option value="bluewave_theme">BlueWave Theme</option>
                                                    <option value="theme_anemone">Anemone</option>
                                                    <option value="theme_autoflip">Autoflip</option>
                                                </select>
                                                <div id="website-design-input-error" class="text-danger small mt-2" style="display: none;"></div>
                                            </div>
                                            <div class="col-md-6 col-lg-8">
                                                <label class="form-label">Required Project Themes</label>
                                                <div class="d-flex gap-3 align-items-center">
                                                    <div class="form-check">
                                                        <input class="form-check-input" type="checkbox" value="deployable_brand_theme" id="req-theme-deployable" checked disabled>
                                                        <label class="form-check-label small" for="req-theme-deployable">deployable_brand_theme (will be added)</label>
                                                    </div>
                                                    <div class="form-check">
                                                        <input class="form-check-input" type="checkbox" value="bluewave_theme" id="req-theme-bluewave" checked disabled>
                                                        <label class="form-check-label small" for="req-theme-bluewave">bluewave_theme (will be added)</label>
                                                    </div>
                                                </div>
                                                <small class="text-muted d-block mt-2">You will be asked to confirm adding these themes when creating the environment.</small>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- This new section allows selecting the Odoo version -->
                                    <div class="mb-3">
                                        <h6>Select Odoo Version</h6>
                                        <p class="text-muted small">Choose the version for your self-hosted Odoo environment.</p>
                                        <select class="form-select" id="odoo-version-input">
                                            <option value="19.0">Odoo 19.0 (Latest)</option>
                                            <option value="18.0">Odoo 18.0</option>
                                            <option value="17.0">Odoo 17.0</option>
                                        </select>
                                    </div>
                                    <div class="mb-3">
                                        <h6>Database Name</h6>
                                        <p class="text-muted small">Optional. If empty, a fresh name will be generated.</p>
                                        <input type="text" id="odoo-dbname-input" class="form-control" placeholder="e.g. agency_crm_site">
                                    </div>
                                    <div class="mb-3 border rounded p-3 bg-light">
                                        <div class="d-flex justify-content-between align-items-center mb-2">
                                            <div>
                                                <h6 class="mb-0">Brand &amp; Theming (optional)</h6>
                                                <p class="text-muted small mb-0">Set brand info before the environment is created.</p>
                                            </div>
                                        </div>
                                        <div class="row g-3">
                                            <div class="col-md-6">
                                                <label class="form-label">Brand Name</label>
                                                <input type="text" id="brand-name-input" class="form-control" placeholder="e.g. Navy Labs">
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">Brand Code</label>
                                                <input type="text" id="brand-code-input" class="form-control" placeholder="e.g. navylabs">
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">Primary Color</label>
                                                <input type="color" id="brand-primary-input" class="form-control form-control-color" value="#1f4f8a" title="Primary color">
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">Secondary Color</label>
                                                <input type="color" id="brand-secondary-input" class="form-control form-control-color" value="#223047" title="Secondary color">
                                            </div>
                                            <div class="col-12">
                                                <label class="form-label">Logo URL (optional)</label>
                                                <input type="url" id="brand-logo-input" class="form-control" placeholder="https://.../logo.png">
                                            </div>
                                        </div>
                                    </div>
                                    <div class="d-flex gap-2 align-items-center">
                                        <button id="execute-btn" class="btn btn-success" style="display:inline-block">Create Environment</button>
                                        <button id="create-without-plan" class="btn btn-outline-secondary">Create Without Plan</button>
                                        <small id="create-help" class="text-muted ms-3">Tip: if planning fails, use "Create Without Plan" to proceed with sensible defaults.</small>
                                    </div>
                                </div>
                            </div>

                            <!-- Step 3: Creation Status -->
                            <div id="creation-status" class="card shadow-sm border-0" style="display: none;">
                                <div class="card-header bg-transparent">
                                    <h5>Step 3: Environment Creation Status</h5>
                                </div>
                                <div class="card-body">
                                    <pre id="creation-log" class="bg-dark text-white p-3 rounded" style="max-height: 400px; overflow-y: auto;"></pre>
                                    <div id="environment-link-container" class="mt-3 text-center" style="display: none;">
                                        <p class="fw-bold">Your new environment is ready!</p>
                                        <!-- The link to the standard Odoo backend -->
                                        <a id="environment-link" href="#" class="btn btn-lg btn-primary" target="_blank">ðŸš€ Access Odoo Backend</a>
                                    </div>
                                </div>
                            </div>

                            <!-- Environment History -->
                            <div class="card shadow-sm border-0 mt-4" id="env-history-card">
                                <div class="card-header bg-transparent d-flex justify-content-between align-items-center">
                                    <h5 class="mb-0">Previously Opened Environments</h5>
                                    <button class="btn btn-sm btn-outline-secondary" id="env-history-refresh">Refresh</button>
                                </div>
                                <div class="card-body p-0">
                                    <div id="env-history-empty" class="text-muted p-3" style="display: none;">No environments recorded yet.</div>
                                    <div class="table-responsive mb-0">
                                        <table class="table table-sm align-middle mb-0">
                                            <thead class="table-light">
                                                <tr>
                                                    <th style="width: 18%">Opened</th>
                                                    <th style="width: 22%">Database</th>
                                                    <th style="width: 10%">Version</th>
                                                    <th>Modules</th>
                                                    <th style="width: 18%" class="text-end">Actions</th>
                                                </tr>
                                            </thead>
                                            <tbody id="env-history-body"></tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Option 2: Odoo Online (SaaS) -->
                <div class="accordion-item">
                    <h2 class="accordion-header" id="headingOnline">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOnline" aria-expanded="false" aria-controls="collapseOnline">
                            <strong>Odoo Online (SaaS)</strong>
                        </button>
                    </h2>
                    <div id="collapseOnline" class="accordion-collapse collapse" aria-labelledby="headingOnline" data-bs-parent="#odoo-options-accordion">
                        <div class="accordion-body">
                            <p>Odoo Online is a SaaS platform managed by Odoo. Use the planner below to get a customized link that pre-selects the right apps for you on the Odoo trial page.</p>
                            
                            <!-- Step 1: Planning -->
                            <div class="card shadow-sm mb-4 border-0">
                                <div class="card-header bg-transparent pt-3">
                                    <h5>Step 1: Plan Your Odoo Online Instance</h5>
                                </div>
                                <div class="card-body">
                                    <div class="mb-3">
                                        <label for="business-need-online" class="form-label">Describe your business need:</label>
                                        <textarea class="form-control" id="business-need-online" rows="3" placeholder="e.g., 'I want to manage customer relationships and send them marketing emails.'"></textarea>
                                    </div>
                                    <button data-plan-type="online" class="btn btn-primary plan-btn">
                                        <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true" style="display: none;"></span>
                                        Generate Trial Link
                                    </button>
                                    <div id="plan-error-online" class="alert alert-danger mt-3" style="display: none;"></div>
                                </div>
                            </div>

                            <!-- Step 2: Launch -->
                            <div id="plan-display-online" class="card shadow-sm mb-4 border-0" style="display: none;">
                                <div class="card-header bg-transparent">
                                    <h5>Step 2: Launch on Odoo.com</h5>
                                </div>
                                <div class="card-body">
                                    <p>The agent recommends the following setup. Click the button to open the Odoo trial page with these apps pre-selected.</p>
                                    <div id="plan-summary-online" class="alert alert-info"></div>
                                    <a id="execute-btn-online" href="#" target="_blank" rel="noopener noreferrer" class="btn btn-success" style="display: none;">Create Free Trial on Odoo.com</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Option 3: Odoo.sh (PaaS) -->
                <div class="accordion-item">
                    <h2 class="accordion-header" id="headingSh">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSh" aria-expanded="false" aria-controls="collapseSh">
                            <strong>Odoo.sh (PaaS)</strong>
                        </button>
                    </h2>
                    <div id="collapseSh" class="accordion-collapse collapse" aria-labelledby="headingSh" data-bs-parent="#odoo-options-accordion">
                        <div class="accordion-body">
                            <p>Odoo.sh is a PaaS for hosting custom projects. It integrates with GitHub for development and deployment. Use the planner to generate a custom deployment guide based on your needs.</p>
    
                            <!-- Step 1: Planning -->
                            <div class="card shadow-sm mb-4 border-0">
                                <div class="card-header bg-transparent pt-3">
                                    <h5>Step 1: Plan Your Odoo.sh Project</h5>
                                </div>
                                <div class="card-body">
                                    <div class="mb-3">
                                        <label for="business-need-sh" class="form-label">Describe your business need:</label>
                                        <textarea class="form-control" id="business-need-sh" rows="3" placeholder="e.g., 'I need a full ERP with custom modules for manufacturing.'"></textarea>
                                    </div>
                                    <button data-plan-type="sh" class="btn btn-primary plan-btn">
                                        <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true" style="display: none;"></span>
                                        Generate Deployment Guide
                                    </button>
                                    <div id="plan-error-sh" class="alert alert-danger mt-3" style="display: none;"></div>
                                </div>
                            </div>

                            <!-- Step 2: Follow Guide -->
                            <div id="plan-display-sh" class="card shadow-sm mb-4 border-0" style="display: none;">
                                <div class="card-header bg-transparent">
                                    <h5>Step 2: Follow Your Custom Guide</h5>
                                </div>
                                <div class="card-body">
                                    <p>The agent has generated the following guide to help you set up your project on Odoo.sh.</p>
                                    <div id="plan-summary-sh" class="bg-light p-3 rounded border" style="white-space: pre-wrap;"></div>
                                    <a href="https://www.odoo.sh" target="_blank" rel="noopener noreferrer" class="btn btn-info mt-3">Go to Odoo.sh to Get Started</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div id="toast-container" class="toast-container position-fixed bottom-0 end-0 p-3" aria-live="polite" aria-atomic="true" style="z-index: 1100;"></div>